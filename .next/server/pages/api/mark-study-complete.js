"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "pages/api/mark-study-complete";
exports.ids = ["pages/api/mark-study-complete"];
exports.modules = {

/***/ "@supabase/supabase-js":
/*!****************************************!*\
  !*** external "@supabase/supabase-js" ***!
  \****************************************/
/***/ ((module) => {

module.exports = require("@supabase/supabase-js");

/***/ }),

/***/ "nodemailer":
/*!*****************************!*\
  !*** external "nodemailer" ***!
  \*****************************/
/***/ ((module) => {

module.exports = require("nodemailer");

/***/ }),

/***/ "(api)/./pages/api/mark-study-complete.ts":
/*!******************************************!*\
  !*** ./pages/api/mark-study-complete.ts ***!
  \******************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (/* binding */ handler)\n/* harmony export */ });\n/* harmony import */ var _supabase_supabase_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @supabase/supabase-js */ \"@supabase/supabase-js\");\n/* harmony import */ var _supabase_supabase_js__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(_supabase_supabase_js__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var nodemailer__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! nodemailer */ \"nodemailer\");\n/* harmony import */ var nodemailer__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(nodemailer__WEBPACK_IMPORTED_MODULE_1__);\n\n\n// Supabase Client\nconst supabase = (0,_supabase_supabase_js__WEBPACK_IMPORTED_MODULE_0__.createClient)(process.env.SUPABASE_URL, process.env.SUPABASE_SERVICE_ROLE_KEY);\n// Email Transporter - You need to add these to your .env.local\nconst transporter = nodemailer__WEBPACK_IMPORTED_MODULE_1___default().createTransport({\n    host: process.env.EMAIL_SMTP_HOST,\n    port: Number(process.env.EMAIL_SMTP_PORT),\n    secure: true,\n    auth: {\n        user: process.env.EMAIL_SMTP_USER,\n        pass: process.env.EMAIL_SMTP_PASS\n    }\n});\nasync function handler(req, res) {\n    if (req.method !== \"POST\") {\n        return res.status(405).json({\n            error: \"Method not allowed\"\n        });\n    }\n    const { studyID } = req.body;\n    if (!studyID) {\n        return res.status(400).json({\n            error: \"Missing studyID\"\n        });\n    }\n    // 1️⃣ Update Study Status to Complete\n    const { error: updateError } = await supabase.from(\"studies\").update({\n        status: \"Complete\"\n    }).eq(\"id\", studyID);\n    if (updateError) {\n        console.error(\"Error updating study:\", updateError);\n        return res.status(500).json({\n            error: \"Failed to update study\"\n        });\n    }\n    // 2️⃣ Fetch Study Details to Get Customer Email\n    const { data: study, error: fetchError } = await supabase.from(\"studies\").select(\"id, customerEmail, customerName\").eq(\"id\", studyID).single();\n    if (fetchError || !study) {\n        return res.status(404).json({\n            error: \"Study not found\"\n        });\n    }\n    // 3️⃣ Build the Magic Link\n    const magicLink = `${\"http://localhost:3000\"}/results/${studyID}`;\n    // 4️⃣ Send Email with Magic Link\n    const emailOptions = {\n        from: '\"Usability500 Team\" <support@usability500.com>',\n        to: study.customerEmail,\n        subject: \"Your Usability Study Results are Ready! \\uD83C\\uDF89\",\n        html: `\n            <p>Hi ${study.customerName},</p>\n            <p>Your usability study is complete! You can view your results at the link below:</p>\n            <p><a href=\"${magicLink}\">${magicLink}</a></p>\n            <p>Thank you for using Usability500!</p>\n        `\n    };\n    try {\n        await transporter.sendMail(emailOptions);\n    } catch (emailError) {\n        console.error(\"Failed to send email:\", emailError);\n        return res.status(500).json({\n            error: \"Failed to send email\"\n        });\n    }\n    return res.status(200).json({\n        success: true,\n        message: \"Study marked complete and email sent!\"\n    });\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi9wYWdlcy9hcGkvbWFyay1zdHVkeS1jb21wbGV0ZS50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7OztBQUFxRDtBQUNqQjtBQUVwQyxrQkFBa0I7QUFDbEIsTUFBTUUsV0FBV0YsbUVBQVlBLENBQUNHLFFBQVFDLEdBQUcsQ0FBQ0MsWUFBWSxFQUFHRixRQUFRQyxHQUFHLENBQUNFLHlCQUF5QjtBQUU5RiwrREFBK0Q7QUFDL0QsTUFBTUMsY0FBY04saUVBQTBCLENBQUM7SUFDM0NRLE1BQU1OLFFBQVFDLEdBQUcsQ0FBQ00sZUFBZTtJQUNqQ0MsTUFBTUMsT0FBT1QsUUFBUUMsR0FBRyxDQUFDUyxlQUFlO0lBQ3hDQyxRQUFRO0lBQ1JDLE1BQU07UUFDRkMsTUFBTWIsUUFBUUMsR0FBRyxDQUFDYSxlQUFlO1FBQ2pDQyxNQUFNZixRQUFRQyxHQUFHLENBQUNlLGVBQWU7SUFDckM7QUFDSjtBQUVlLGVBQWVDLFFBQVFDLEdBQUcsRUFBRUMsR0FBRztJQUMxQyxJQUFJRCxJQUFJRSxNQUFNLEtBQUssUUFBUTtRQUN2QixPQUFPRCxJQUFJRSxNQUFNLENBQUMsS0FBS0MsSUFBSSxDQUFDO1lBQUVDLE9BQU87UUFBcUI7SUFDOUQ7SUFFQSxNQUFNLEVBQUVDLE9BQU8sRUFBRSxHQUFHTixJQUFJTyxJQUFJO0lBRTVCLElBQUksQ0FBQ0QsU0FBUztRQUNWLE9BQU9MLElBQUlFLE1BQU0sQ0FBQyxLQUFLQyxJQUFJLENBQUM7WUFBRUMsT0FBTztRQUFrQjtJQUMzRDtJQUVBLHNDQUFzQztJQUN0QyxNQUFNLEVBQUVBLE9BQU9HLFdBQVcsRUFBRSxHQUFHLE1BQU0zQixTQUNoQzRCLElBQUksQ0FBQyxXQUNMQyxNQUFNLENBQUM7UUFBRVAsUUFBUTtJQUFXLEdBQzVCUSxFQUFFLENBQUMsTUFBTUw7SUFFZCxJQUFJRSxhQUFhO1FBQ2JJLFFBQVFQLEtBQUssQ0FBQyx5QkFBeUJHO1FBQ3ZDLE9BQU9QLElBQUlFLE1BQU0sQ0FBQyxLQUFLQyxJQUFJLENBQUM7WUFBRUMsT0FBTztRQUF5QjtJQUNsRTtJQUVBLGdEQUFnRDtJQUNoRCxNQUFNLEVBQUVRLE1BQU1DLEtBQUssRUFBRVQsT0FBT1UsVUFBVSxFQUFFLEdBQUcsTUFBTWxDLFNBQzVDNEIsSUFBSSxDQUFDLFdBQ0xPLE1BQU0sQ0FBQyxtQ0FDUEwsRUFBRSxDQUFDLE1BQU1MLFNBQ1RXLE1BQU07SUFFWCxJQUFJRixjQUFjLENBQUNELE9BQU87UUFDdEIsT0FBT2IsSUFBSUUsTUFBTSxDQUFDLEtBQUtDLElBQUksQ0FBQztZQUFFQyxPQUFPO1FBQWtCO0lBQzNEO0lBRUEsMkJBQTJCO0lBQzNCLE1BQU1hLFlBQVksQ0FBQyxFQUFFcEMsdUJBQWdDLENBQUMsU0FBUyxFQUFFd0IsUUFBUSxDQUFDO0lBRTFFLGlDQUFpQztJQUNqQyxNQUFNYyxlQUFlO1FBQ2pCWCxNQUFNO1FBQ05ZLElBQUlQLE1BQU1RLGFBQWE7UUFDdkJDLFNBQVM7UUFDVEMsTUFBTSxDQUFDO2tCQUNHLEVBQUVWLE1BQU1XLFlBQVksQ0FBQzs7d0JBRWYsRUFBRVAsVUFBVSxFQUFFLEVBQUVBLFVBQVU7O1FBRTFDLENBQUM7SUFDTDtJQUVBLElBQUk7UUFDQSxNQUFNaEMsWUFBWXdDLFFBQVEsQ0FBQ047SUFDL0IsRUFBRSxPQUFPTyxZQUFZO1FBQ2pCZixRQUFRUCxLQUFLLENBQUMseUJBQXlCc0I7UUFDdkMsT0FBTzFCLElBQUlFLE1BQU0sQ0FBQyxLQUFLQyxJQUFJLENBQUM7WUFBRUMsT0FBTztRQUF1QjtJQUNoRTtJQUVBLE9BQU9KLElBQUlFLE1BQU0sQ0FBQyxLQUFLQyxJQUFJLENBQUM7UUFBRXdCLFNBQVM7UUFBTUMsU0FBUztJQUF3QztBQUNsRyIsInNvdXJjZXMiOlsid2VicGFjazovL3VzYWJpbGl0eTUwMC10ZXN0ZXItcG9ydGFsLy4vcGFnZXMvYXBpL21hcmstc3R1ZHktY29tcGxldGUudHM/MjUxYyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBjcmVhdGVDbGllbnQgfSBmcm9tICdAc3VwYWJhc2Uvc3VwYWJhc2UtanMnO1xuaW1wb3J0IG5vZGVtYWlsZXIgZnJvbSAnbm9kZW1haWxlcic7XG5cbi8vIFN1cGFiYXNlIENsaWVudFxuY29uc3Qgc3VwYWJhc2UgPSBjcmVhdGVDbGllbnQocHJvY2Vzcy5lbnYuU1VQQUJBU0VfVVJMISwgcHJvY2Vzcy5lbnYuU1VQQUJBU0VfU0VSVklDRV9ST0xFX0tFWSEpO1xuXG4vLyBFbWFpbCBUcmFuc3BvcnRlciAtIFlvdSBuZWVkIHRvIGFkZCB0aGVzZSB0byB5b3VyIC5lbnYubG9jYWxcbmNvbnN0IHRyYW5zcG9ydGVyID0gbm9kZW1haWxlci5jcmVhdGVUcmFuc3BvcnQoe1xuICAgIGhvc3Q6IHByb2Nlc3MuZW52LkVNQUlMX1NNVFBfSE9TVCEsXG4gICAgcG9ydDogTnVtYmVyKHByb2Nlc3MuZW52LkVNQUlMX1NNVFBfUE9SVCEpLFxuICAgIHNlY3VyZTogdHJ1ZSwgLy8gVXN1YWxseSB0cnVlIGZvciA0NjUsIGZhbHNlIGZvciBvdGhlciBwb3J0c1xuICAgIGF1dGg6IHtcbiAgICAgICAgdXNlcjogcHJvY2Vzcy5lbnYuRU1BSUxfU01UUF9VU0VSISxcbiAgICAgICAgcGFzczogcHJvY2Vzcy5lbnYuRU1BSUxfU01UUF9QQVNTIVxuICAgIH1cbn0pO1xuXG5leHBvcnQgZGVmYXVsdCBhc3luYyBmdW5jdGlvbiBoYW5kbGVyKHJlcSwgcmVzKSB7XG4gICAgaWYgKHJlcS5tZXRob2QgIT09ICdQT1NUJykge1xuICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDUpLmpzb24oeyBlcnJvcjogJ01ldGhvZCBub3QgYWxsb3dlZCcgfSk7XG4gICAgfVxuXG4gICAgY29uc3QgeyBzdHVkeUlEIH0gPSByZXEuYm9keTtcblxuICAgIGlmICghc3R1ZHlJRCkge1xuICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDApLmpzb24oeyBlcnJvcjogJ01pc3Npbmcgc3R1ZHlJRCcgfSk7XG4gICAgfVxuXG4gICAgLy8gMe+4j+KDoyBVcGRhdGUgU3R1ZHkgU3RhdHVzIHRvIENvbXBsZXRlXG4gICAgY29uc3QgeyBlcnJvcjogdXBkYXRlRXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlXG4gICAgICAgIC5mcm9tKCdzdHVkaWVzJylcbiAgICAgICAgLnVwZGF0ZSh7IHN0YXR1czogJ0NvbXBsZXRlJyB9KVxuICAgICAgICAuZXEoJ2lkJywgc3R1ZHlJRCk7XG5cbiAgICBpZiAodXBkYXRlRXJyb3IpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgdXBkYXRpbmcgc3R1ZHk6JywgdXBkYXRlRXJyb3IpO1xuICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg1MDApLmpzb24oeyBlcnJvcjogJ0ZhaWxlZCB0byB1cGRhdGUgc3R1ZHknIH0pO1xuICAgIH1cblxuICAgIC8vIDLvuI/ig6MgRmV0Y2ggU3R1ZHkgRGV0YWlscyB0byBHZXQgQ3VzdG9tZXIgRW1haWxcbiAgICBjb25zdCB7IGRhdGE6IHN0dWR5LCBlcnJvcjogZmV0Y2hFcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VcbiAgICAgICAgLmZyb20oJ3N0dWRpZXMnKVxuICAgICAgICAuc2VsZWN0KCdpZCwgY3VzdG9tZXJFbWFpbCwgY3VzdG9tZXJOYW1lJylcbiAgICAgICAgLmVxKCdpZCcsIHN0dWR5SUQpXG4gICAgICAgIC5zaW5nbGUoKTtcblxuICAgIGlmIChmZXRjaEVycm9yIHx8ICFzdHVkeSkge1xuICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDQpLmpzb24oeyBlcnJvcjogJ1N0dWR5IG5vdCBmb3VuZCcgfSk7XG4gICAgfVxuXG4gICAgLy8gM++4j+KDoyBCdWlsZCB0aGUgTWFnaWMgTGlua1xuICAgIGNvbnN0IG1hZ2ljTGluayA9IGAke3Byb2Nlc3MuZW52Lk5FWFRfUFVCTElDX0JBU0VfVVJMfS9yZXN1bHRzLyR7c3R1ZHlJRH1gO1xuXG4gICAgLy8gNO+4j+KDoyBTZW5kIEVtYWlsIHdpdGggTWFnaWMgTGlua1xuICAgIGNvbnN0IGVtYWlsT3B0aW9ucyA9IHtcbiAgICAgICAgZnJvbTogJ1wiVXNhYmlsaXR5NTAwIFRlYW1cIiA8c3VwcG9ydEB1c2FiaWxpdHk1MDAuY29tPicsXG4gICAgICAgIHRvOiBzdHVkeS5jdXN0b21lckVtYWlsLFxuICAgICAgICBzdWJqZWN0OiAnWW91ciBVc2FiaWxpdHkgU3R1ZHkgUmVzdWx0cyBhcmUgUmVhZHkhIPCfjoknLFxuICAgICAgICBodG1sOiBgXG4gICAgICAgICAgICA8cD5IaSAke3N0dWR5LmN1c3RvbWVyTmFtZX0sPC9wPlxuICAgICAgICAgICAgPHA+WW91ciB1c2FiaWxpdHkgc3R1ZHkgaXMgY29tcGxldGUhIFlvdSBjYW4gdmlldyB5b3VyIHJlc3VsdHMgYXQgdGhlIGxpbmsgYmVsb3c6PC9wPlxuICAgICAgICAgICAgPHA+PGEgaHJlZj1cIiR7bWFnaWNMaW5rfVwiPiR7bWFnaWNMaW5rfTwvYT48L3A+XG4gICAgICAgICAgICA8cD5UaGFuayB5b3UgZm9yIHVzaW5nIFVzYWJpbGl0eTUwMCE8L3A+XG4gICAgICAgIGBcbiAgICB9O1xuXG4gICAgdHJ5IHtcbiAgICAgICAgYXdhaXQgdHJhbnNwb3J0ZXIuc2VuZE1haWwoZW1haWxPcHRpb25zKTtcbiAgICB9IGNhdGNoIChlbWFpbEVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoJ0ZhaWxlZCB0byBzZW5kIGVtYWlsOicsIGVtYWlsRXJyb3IpO1xuICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg1MDApLmpzb24oeyBlcnJvcjogJ0ZhaWxlZCB0byBzZW5kIGVtYWlsJyB9KTtcbiAgICB9XG5cbiAgICByZXR1cm4gcmVzLnN0YXR1cygyMDApLmpzb24oeyBzdWNjZXNzOiB0cnVlLCBtZXNzYWdlOiAnU3R1ZHkgbWFya2VkIGNvbXBsZXRlIGFuZCBlbWFpbCBzZW50IScgfSk7XG59XG4iXSwibmFtZXMiOlsiY3JlYXRlQ2xpZW50Iiwibm9kZW1haWxlciIsInN1cGFiYXNlIiwicHJvY2VzcyIsImVudiIsIlNVUEFCQVNFX1VSTCIsIlNVUEFCQVNFX1NFUlZJQ0VfUk9MRV9LRVkiLCJ0cmFuc3BvcnRlciIsImNyZWF0ZVRyYW5zcG9ydCIsImhvc3QiLCJFTUFJTF9TTVRQX0hPU1QiLCJwb3J0IiwiTnVtYmVyIiwiRU1BSUxfU01UUF9QT1JUIiwic2VjdXJlIiwiYXV0aCIsInVzZXIiLCJFTUFJTF9TTVRQX1VTRVIiLCJwYXNzIiwiRU1BSUxfU01UUF9QQVNTIiwiaGFuZGxlciIsInJlcSIsInJlcyIsIm1ldGhvZCIsInN0YXR1cyIsImpzb24iLCJlcnJvciIsInN0dWR5SUQiLCJib2R5IiwidXBkYXRlRXJyb3IiLCJmcm9tIiwidXBkYXRlIiwiZXEiLCJjb25zb2xlIiwiZGF0YSIsInN0dWR5IiwiZmV0Y2hFcnJvciIsInNlbGVjdCIsInNpbmdsZSIsIm1hZ2ljTGluayIsIk5FWFRfUFVCTElDX0JBU0VfVVJMIiwiZW1haWxPcHRpb25zIiwidG8iLCJjdXN0b21lckVtYWlsIiwic3ViamVjdCIsImh0bWwiLCJjdXN0b21lck5hbWUiLCJzZW5kTWFpbCIsImVtYWlsRXJyb3IiLCJzdWNjZXNzIiwibWVzc2FnZSJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(api)/./pages/api/mark-study-complete.ts\n");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../webpack-api-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = (__webpack_exec__("(api)/./pages/api/mark-study-complete.ts"));
module.exports = __webpack_exports__;

})();